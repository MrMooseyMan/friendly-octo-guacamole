<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Home 9 Rounds</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;overflow:hidden}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    background:#0a0a0f;
    color:#e0e0e0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    min-height:100vh;
    min-height:100dvh;
    -webkit-tap-highlight-color:transparent;
    user-select:none;
  }

  /* --- Nav Tabs --- */
  .nav-tabs{
    display:flex;width:100%;max-width:420px;
    padding:12px 20px 0;gap:4px;flex-shrink:0;
  }
  .nav-tab{
    flex:1;padding:10px 0;border:none;border-radius:10px 10px 0 0;
    font-size:.85rem;font-weight:700;cursor:pointer;
    text-transform:uppercase;letter-spacing:.08em;
    transition:all .15s;background:transparent;color:#555;
    border-bottom:2px solid transparent;
  }
  .nav-tab.active{color:#00ff88;border-bottom-color:#00ff88}
  .nav-tab:not(.active):hover{color:#888}
  .nav-tabs.hidden{display:none}

  /* --- Workout Select Screen --- */
  #select-screen{
    display:flex;flex-direction:column;align-items:center;
    justify-content:flex-start;gap:20px;width:100%;padding:20px;
    flex:1;overflow-y:auto;
  }
  #select-screen h1{
    font-size:2rem;font-weight:800;letter-spacing:-.02em;
    background:linear-gradient(135deg,#00ff88,#00bbff);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    background-clip:text;
  }
  #select-screen p{color:#888;font-size:.95rem;margin-bottom:10px}
  .workout-btn{
    width:min(90%,360px);padding:18px 24px;border:2px solid #222;
    border-radius:14px;background:#111;color:#fff;font-size:1.1rem;
    font-weight:600;cursor:pointer;transition:all .15s;text-align:left;
  }
  .workout-btn:hover,.workout-btn:active{
    border-color:#00ff88;background:#0a1a10;transform:scale(1.02);
  }
  .workout-btn .day{color:#00ff88;font-size:.8rem;font-weight:700;
    text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px}
  .workout-btn .name{font-size:1.15rem}
  .workout-btn .week-weight{font-size:.75rem;color:#888;margin-top:4px}

  /* --- Timer Screen --- */
  #timer-screen{
    display:none;flex-direction:column;align-items:center;
    justify-content:space-between;width:100%;height:100vh;height:100dvh;
    padding:16px 16px env(safe-area-inset-bottom,16px);
  }

  /* Round lights */
  .round-lights{
    display:flex;gap:8px;padding:8px 0;flex-shrink:0;
  }
  .round-light{
    width:28px;height:28px;border-radius:50%;
    background:#1a1a22;border:2px solid #333;
    transition:all .3s;font-size:.7rem;font-weight:700;
    display:flex;align-items:center;justify-content:center;color:#555;
  }
  .round-light.done{background:#00ff88;border-color:#00ff88;color:#000}
  .round-light.active{
    background:#00ff88;border-color:#00ff88;color:#000;
    box-shadow:0 0 16px #00ff8866;transform:scale(1.15);
  }
  .round-light.active.rest{
    background:#3388ff;border-color:#3388ff;
    box-shadow:0 0 16px #3388ff66;
  }
  .round-light.active.warning{
    background:#ffaa00;border-color:#ffaa00;
    box-shadow:0 0 16px #ffaa0066;
  }

  /* Center content */
  .timer-center{
    flex:1;display:flex;flex-direction:column;
    align-items:center;justify-content:center;
    width:100%;max-width:420px;gap:8px;
  }
  .phase-label{
    font-size:1rem;font-weight:700;text-transform:uppercase;
    letter-spacing:.15em;color:#00ff88;
  }
  .phase-label.rest{color:#3388ff}
  .phase-label.warning{color:#ffaa00}
  .phase-label.countdown{color:#ff4444}

  .timer-display{
    font-size:min(28vw,160px);font-weight:800;
    font-variant-numeric:tabular-nums;line-height:1;
    color:#fff;text-shadow:0 0 40px #00ff8833;
    transition:text-shadow .3s,color .3s;
  }
  .timer-display.rest{text-shadow:0 0 40px #3388ff33}
  .timer-display.warning{color:#ffaa00;text-shadow:0 0 40px #ffaa0044}
  .timer-display.countdown{color:#ff4444;text-shadow:0 0 60px #ff444466;font-size:min(40vw,220px)}

  .station-name{
    font-size:1.4rem;font-weight:700;text-align:center;
    margin-top:8px;color:#fff;padding:0 10px;
  }
  .station-desc{
    font-size:.9rem;color:#aaa;text-align:center;
    line-height:1.4;padding:0 16px;max-height:120px;overflow-y:auto;
  }
  .next-preview{
    font-size:.85rem;color:#667;text-align:center;margin-top:8px;
  }
  .next-preview span{color:#aaa}

  /* Bottom controls */
  .controls{
    display:flex;gap:14px;padding:10px 0;flex-shrink:0;
  }
  .ctrl-btn{
    padding:14px 28px;border:none;border-radius:12px;
    font-size:1rem;font-weight:700;cursor:pointer;
    transition:all .15s;
  }
  .ctrl-btn.primary{background:#00ff88;color:#000}
  .ctrl-btn.primary:active{background:#00dd77;transform:scale(.96)}
  .ctrl-btn.danger{background:#331111;color:#ff4444;border:1px solid #441111}
  .ctrl-btn.danger:active{background:#441111;transform:scale(.96)}
  .ctrl-btn.secondary{background:#1a1a22;color:#aaa;border:1px solid #333}
  .ctrl-btn.secondary:active{background:#222;transform:scale(.96)}

  /* Done screen */
  #done-screen{
    display:none;flex-direction:column;align-items:center;
    justify-content:center;gap:20px;height:100vh;height:100dvh;
  }
  #done-screen h1{font-size:2.2rem;font-weight:800;color:#00ff88}
  #done-screen p{color:#888;font-size:1.1rem}
  #done-screen .time{font-size:1.6rem;color:#fff;font-weight:700}

  /* Countdown overlay */
  #countdown-overlay{
    display:none;position:fixed;inset:0;background:#0a0a0fee;
    z-index:100;align-items:center;justify-content:center;
    flex-direction:column;gap:16px;
  }
  #countdown-overlay .count{
    font-size:min(50vw,280px);font-weight:900;color:#ff4444;
    text-shadow:0 0 80px #ff444466;line-height:1;
  }
  #countdown-overlay .label{
    font-size:1.2rem;color:#888;font-weight:600;text-transform:uppercase;
    letter-spacing:.15em;
  }

  /* Wake lock indicator */
  .wake-lock{
    position:fixed;top:8px;right:12px;font-size:.7rem;
    color:#333;pointer-events:none;
  }

  /* --- Generate Workout --- */
  .divider{
    width:min(90%,360px);display:flex;align-items:center;gap:12px;
    color:#444;font-size:.75rem;text-transform:uppercase;letter-spacing:.12em;
  }
  .divider::before,.divider::after{content:'';flex:1;height:1px;background:#222}

  .generate-btn{
    width:min(90%,360px);padding:18px 24px;border:2px solid #222;
    border-radius:14px;background:linear-gradient(135deg,#111 0%,#0a0f1a 100%);
    color:#fff;font-size:1.1rem;font-weight:600;cursor:pointer;
    transition:all .15s;text-align:left;position:relative;overflow:hidden;
  }
  .generate-btn:hover,.generate-btn:active{
    border-color:#00bbff;background:linear-gradient(135deg,#0a1520 0%,#0a0f1a 100%);
    transform:scale(1.02);
  }
  .generate-btn .day{color:#00bbff;font-size:.8rem;font-weight:700;
    text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px}

  /* Generate modal */
  #generate-modal{
    display:none;position:fixed;inset:0;background:#0a0a0fee;
    z-index:200;align-items:center;justify-content:center;
    flex-direction:column;padding:20px;
  }
  .gen-card{
    background:#111;border:1px solid #222;border-radius:18px;
    padding:28px 24px;width:min(95%,400px);max-height:90vh;
    overflow-y:auto;display:flex;flex-direction:column;gap:20px;
  }
  .gen-card h2{
    font-size:1.4rem;font-weight:800;text-align:center;
    background:linear-gradient(135deg,#00ff88,#00bbff);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    background-clip:text;
  }
  .gen-section{display:flex;flex-direction:column;gap:8px}
  .gen-section label{font-size:.8rem;font-weight:700;color:#888;
    text-transform:uppercase;letter-spacing:.08em}
  .gen-chips{display:flex;flex-wrap:wrap;gap:8px}
  .gen-chip{
    padding:10px 16px;border:2px solid #222;border-radius:10px;
    background:#0a0a0f;color:#aaa;font-size:.9rem;font-weight:600;
    cursor:pointer;transition:all .15s;
  }
  .gen-chip:hover{border-color:#444}
  .gen-chip.selected{border-color:#00ff88;color:#00ff88;background:#0a1a10}
  .gen-chip.selected-blue{border-color:#00bbff;color:#00bbff;background:#0a1020}

  .equip-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .equip-toggle{
    padding:10px 12px;border:2px solid #222;border-radius:10px;
    background:#0a0a0f;color:#666;font-size:.85rem;font-weight:600;
    cursor:pointer;transition:all .15s;text-align:center;
  }
  .equip-toggle:hover{border-color:#444}
  .equip-toggle.on{border-color:#00ff88;color:#00ff88;background:#0a1a10}

  .gen-actions{display:flex;gap:12px}
  .gen-actions .ctrl-btn{flex:1;text-align:center}

  .api-key-row{display:flex;gap:8px}
  .api-key-row input{
    flex:1;padding:10px 14px;border:2px solid #222;border-radius:10px;
    background:#0a0a0f;color:#fff;font-size:.9rem;font-family:inherit;
    outline:none;transition:border-color .15s;
  }
  .api-key-row input:focus{border-color:#00bbff}
  .api-key-row input::placeholder{color:#444}
  .api-key-saved{font-size:.75rem;color:#00ff88;display:none}

  /* Loading state */
  .gen-loading{
    display:none;flex-direction:column;align-items:center;gap:16px;
    padding:20px 0;
  }
  .gen-loading.active{display:flex}
  .gen-spinner{
    width:40px;height:40px;border:3px solid #222;
    border-top-color:#00bbff;border-radius:50%;
    animation:spin .8s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  .gen-loading p{color:#888;font-size:.9rem;text-align:center}
  .gen-error{color:#ff4444;font-size:.85rem;text-align:center;display:none}
  .gen-form.hidden{display:none}

  /* --- Dashboard Screen --- */
  #dashboard-screen{
    display:none;flex-direction:column;align-items:center;
    width:100%;padding:20px;flex:1;overflow-y:auto;
    gap:20px;padding-bottom:40px;
  }
  .dash-header{
    text-align:center;width:100%;max-width:380px;
  }
  .dash-header h1{
    font-size:1.8rem;font-weight:800;letter-spacing:-.02em;
    background:linear-gradient(135deg,#00ff88,#00bbff);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    background-clip:text;margin-bottom:4px;
  }
  .dash-header .subtitle{color:#888;font-size:.85rem}
  .dash-header .week-big{
    font-size:3.5rem;font-weight:900;color:#fff;margin:12px 0 4px;
    line-height:1;
  }
  .dash-header .week-label{
    font-size:.85rem;color:#00ff88;font-weight:700;
    text-transform:uppercase;letter-spacing:.1em;
  }

  /* Progress bar */
  .progress-bar-wrap{
    width:100%;max-width:380px;height:8px;background:#1a1a22;
    border-radius:4px;overflow:hidden;margin-top:8px;
  }
  .progress-bar-fill{
    height:100%;background:linear-gradient(90deg,#00ff88,#00bbff);
    border-radius:4px;transition:width .5s ease;
  }
  .progress-dates{
    display:flex;justify-content:space-between;width:100%;max-width:380px;
    font-size:.7rem;color:#555;margin-top:4px;
  }

  /* Dashboard cards */
  .dash-card{
    width:100%;max-width:380px;background:#111;
    border:1px solid #1a1a22;border-radius:14px;
    padding:20px;
  }
  .dash-card h3{
    font-size:.8rem;font-weight:700;color:#00ff88;
    text-transform:uppercase;letter-spacing:.1em;margin-bottom:14px;
  }
  .dash-card h3.blue{color:#00bbff}
  .dash-card h3.orange{color:#ffaa00}

  /* Lift targets */
  .lift-group{margin-bottom:14px}
  .lift-group:last-child{margin-bottom:0}
  .lift-group-label{
    font-size:.7rem;color:#555;text-transform:uppercase;
    letter-spacing:.08em;margin-bottom:6px;
  }
  .lift-row{
    display:flex;justify-content:space-between;align-items:center;
    padding:6px 0;border-bottom:1px solid #1a1a22;
  }
  .lift-row:last-child{border-bottom:none}
  .lift-name{font-size:.9rem;color:#ccc}
  .lift-target{
    font-size:.9rem;font-weight:700;color:#fff;
    font-variant-numeric:tabular-nums;
  }

  /* Nutrition targets */
  .nutrition-grid{display:flex;flex-direction:column;gap:10px}
  .nutrition-row{
    display:flex;justify-content:space-between;align-items:center;
    padding:8px 12px;background:#0a0a0f;border-radius:8px;
  }
  .nutrition-label{font-size:.85rem;color:#aaa}
  .nutrition-value{font-size:.95rem;font-weight:700;color:#fff}

  /* Check-in form */
  .checkin-form{display:flex;flex-direction:column;gap:12px}
  .checkin-row{display:flex;align-items:center;gap:10px}
  .checkin-row label{
    font-size:.85rem;color:#aaa;width:60px;flex-shrink:0;
  }
  .checkin-row input{
    flex:1;padding:10px 14px;border:2px solid #222;border-radius:10px;
    background:#0a0a0f;color:#fff;font-size:1rem;font-family:inherit;
    outline:none;transition:border-color .15s;
    font-variant-numeric:tabular-nums;
  }
  .checkin-row input:focus{border-color:#00ff88}
  .checkin-row .unit{font-size:.8rem;color:#555;width:30px}
  .checkin-save{
    padding:12px;border:none;border-radius:10px;
    background:#00ff88;color:#000;font-size:.95rem;font-weight:700;
    cursor:pointer;transition:all .15s;
  }
  .checkin-save:active{background:#00dd77;transform:scale(.97)}
  .checkin-saved-msg{
    font-size:.8rem;color:#00ff88;text-align:center;
    display:none;margin-top:4px;
  }

  /* Check-in history */
  .history-table{width:100%}
  .history-row{
    display:flex;justify-content:space-between;
    padding:8px 0;border-bottom:1px solid #1a1a22;
    font-size:.85rem;
  }
  .history-row:last-child{border-bottom:none}
  .history-week{color:#00ff88;font-weight:700;width:65px}
  .history-weight{color:#fff;font-weight:600;width:70px;text-align:center}
  .history-waist{color:#fff;font-weight:600;width:70px;text-align:center}
  .history-header{color:#555;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em}
  .history-empty{color:#444;font-size:.85rem;text-align:center;padding:16px 0}

  /* Rules card */
  .rules-list{display:flex;flex-direction:column;gap:8px}
  .rule-item{
    display:flex;align-items:flex-start;gap:10px;
    font-size:.85rem;color:#ccc;line-height:1.4;
  }
  .rule-check{color:#00ff88;font-weight:700;flex-shrink:0;margin-top:1px}
  .rule-item.warn .rule-check{color:#ff4444}
</style>
</head>
<body>

<!-- Nav Tabs -->
<div class="nav-tabs" id="nav-tabs">
  <button class="nav-tab active" id="tab-workouts" onclick="switchTab('workouts')">Workouts</button>
  <button class="nav-tab" id="tab-dashboard" onclick="switchTab('dashboard')">Dashboard</button>
</div>

<!-- Workout Select -->
<div id="select-screen">
  <h1>Home 9 Rounds</h1>
  <p id="week-subtitle">Pick your workout</p>
  <button class="workout-btn" onclick="startWorkout(0)">
    <div class="day">Push Day</div>
    <div class="name">Chest, Shoulders, Triceps + Bag</div>
    <div class="week-weight" id="push-weight-hint"></div>
  </button>
  <button class="workout-btn" onclick="startWorkout(1)">
    <div class="day">Pull Day</div>
    <div class="name">Back, Biceps + Bag</div>
    <div class="week-weight" id="pull-weight-hint"></div>
  </button>
  <button class="workout-btn" onclick="startWorkout(2)">
    <div class="day">Leg Day</div>
    <div class="name">Legs, Arms + Bag</div>
    <div class="week-weight" id="leg-weight-hint"></div>
  </button>
  <button class="workout-btn" onclick="startWorkout(3)">
    <div class="day">Freestyle</div>
    <div class="name">Full Body Brawler</div>
    <div class="week-weight"></div>
  </button>
  <div class="divider">or</div>
  <button class="generate-btn" onclick="openGenerator()">
    <div class="day">AI Generated</div>
    <div class="name">Build Me a Workout</div>
  </button>
</div>

<!-- Dashboard Screen -->
<div id="dashboard-screen">
  <div class="dash-header">
    <h1>8-Week Recomp</h1>
    <div class="subtitle">Feb 16 - Apr 12, 2026</div>
    <div class="week-big" id="dash-week-num">1</div>
    <div class="week-label" id="dash-week-label">Week 1 of 8</div>
  </div>
  <div class="progress-bar-wrap">
    <div class="progress-bar-fill" id="progress-fill" style="width:0%"></div>
  </div>
  <div class="progress-dates">
    <span>Feb 16</span>
    <span>Apr 12</span>
  </div>

  <!-- This Week's Targets -->
  <div class="dash-card">
    <h3>This Week's Weights</h3>
    <div class="lift-group">
      <div class="lift-group-label">Push Day</div>
      <div class="lift-row">
        <span class="lift-name">Bench Press</span>
        <span class="lift-target" id="t-bench">45 lbs</span>
      </div>
      <div class="lift-row">
        <span class="lift-name">Overhead Press</span>
        <span class="lift-target" id="t-ohp">45 lbs</span>
      </div>
    </div>
    <div class="lift-group">
      <div class="lift-group-label">Pull Day</div>
      <div class="lift-row">
        <span class="lift-name">Pull-ups</span>
        <span class="lift-target" id="t-pullups">AMRAP</span>
      </div>
      <div class="lift-row">
        <span class="lift-name">Barbell Rows</span>
        <span class="lift-target" id="t-rows">45 lbs</span>
      </div>
    </div>
    <div class="lift-group">
      <div class="lift-group-label">Leg Day</div>
      <div class="lift-row">
        <span class="lift-name">Squats</span>
        <span class="lift-target" id="t-squat">45 lbs</span>
      </div>
      <div class="lift-row">
        <span class="lift-name">Romanian Deadlifts</span>
        <span class="lift-target" id="t-rdl">45 lbs</span>
      </div>
    </div>
    <div class="lift-group">
      <div class="lift-group-label">Volume</div>
      <div class="lift-row">
        <span class="lift-name">Sets x Reps</span>
        <span class="lift-target" id="t-volume">3 x 10</span>
      </div>
    </div>
  </div>

  <!-- Nutrition -->
  <div class="dash-card">
    <h3 class="blue">Daily Targets</h3>
    <div class="nutrition-grid">
      <div class="nutrition-row">
        <span class="nutrition-label">Calories</span>
        <span class="nutrition-value">2,400 - 2,600</span>
      </div>
      <div class="nutrition-row">
        <span class="nutrition-label">Protein</span>
        <span class="nutrition-value">160 - 180g</span>
      </div>
      <div class="nutrition-row">
        <span class="nutrition-label">Steps</span>
        <span class="nutrition-value">8,000 - 10,000</span>
      </div>
      <div class="nutrition-row">
        <span class="nutrition-label">Water</span>
        <span class="nutrition-value">1 gallon</span>
      </div>
      <div class="nutrition-row">
        <span class="nutrition-label">Sleep</span>
        <span class="nutrition-value">7 - 8 hours</span>
      </div>
    </div>
  </div>

  <!-- Weekly Check-in -->
  <div class="dash-card">
    <h3 class="orange">Weekly Check-in</h3>
    <div class="checkin-form">
      <div class="checkin-row">
        <label>Weight</label>
        <input type="number" id="checkin-weight" placeholder="200" step="0.1" inputmode="decimal">
        <span class="unit">lbs</span>
      </div>
      <div class="checkin-row">
        <label>Waist</label>
        <input type="number" id="checkin-waist" placeholder="36" step="0.25" inputmode="decimal">
        <span class="unit">in</span>
      </div>
      <button class="checkin-save" onclick="saveCheckin()">Save Week <span id="checkin-week-num">1</span> Check-in</button>
      <div class="checkin-saved-msg" id="checkin-saved-msg">Saved!</div>
    </div>
  </div>

  <!-- History -->
  <div class="dash-card">
    <h3>Progress</h3>
    <div class="history-table">
      <div class="history-row">
        <span class="history-week history-header">Week</span>
        <span class="history-weight history-header">Weight</span>
        <span class="history-waist history-header">Waist</span>
      </div>
      <div id="history-rows"></div>
    </div>
  </div>

  <!-- Rules -->
  <div class="dash-card">
    <h3>Non-Negotiables</h3>
    <div class="rules-list">
      <div class="rule-item"><span class="rule-check">+</span>Hit calorie target 6/7 days</div>
      <div class="rule-item"><span class="rule-check">+</span>160g+ protein daily</div>
      <div class="rule-item"><span class="rule-check">+</span>4 lifting sessions per week</div>
      <div class="rule-item"><span class="rule-check">+</span>8k+ steps daily (Fitbit)</div>
      <div class="rule-item"><span class="rule-check">+</span>7+ hours sleep</div>
      <div class="rule-item warn"><span class="rule-check">x</span>No alcohol</div>
      <div class="rule-item warn"><span class="rule-check">x</span>No liquid calories</div>
      <div class="rule-item warn"><span class="rule-check">x</span>No cheat days</div>
    </div>
  </div>
</div>

<!-- Generate Workout Modal -->
<div id="generate-modal">
  <div class="gen-card">
    <h2>Generate Workout</h2>
    <div class="gen-form" id="gen-form">
      <div class="gen-section">
        <label>Focus</label>
        <div class="gen-chips" id="focus-chips">
          <div class="gen-chip selected" data-val="surprise" onclick="selectFocus(this)">Surprise Me</div>
          <div class="gen-chip" data-val="push" onclick="selectFocus(this)">Push</div>
          <div class="gen-chip" data-val="pull" onclick="selectFocus(this)">Pull</div>
          <div class="gen-chip" data-val="legs" onclick="selectFocus(this)">Legs</div>
          <div class="gen-chip" data-val="full" onclick="selectFocus(this)">Full Body</div>
          <div class="gen-chip" data-val="cardio" onclick="selectFocus(this)">Cardio Heavy</div>
        </div>
      </div>
      <div class="gen-section">
        <label>Equipment Available</label>
        <div class="equip-grid" id="equip-grid">
          <div class="equip-toggle on" data-equip="barbell" onclick="toggleEquip(this)">Barbell</div>
          <div class="equip-toggle on" data-equip="bench" onclick="toggleEquip(this)">Bench</div>
          <div class="equip-toggle on" data-equip="rings" onclick="toggleEquip(this)">Rings</div>
          <div class="equip-toggle on" data-equip="pull-up bar" onclick="toggleEquip(this)">Pull-up Bar</div>
          <div class="equip-toggle on" data-equip="heavy bag" onclick="toggleEquip(this)">Heavy Bag</div>
          <div class="equip-toggle on" data-equip="dumbbells" onclick="toggleEquip(this)">Dumbbells</div>
        </div>
      </div>
      <div class="gen-section">
        <label>OpenRouter API Key</label>
        <div class="api-key-row">
          <input type="password" id="api-key-input" placeholder="sk-or-v1-..." autocomplete="off">
        </div>
        <div class="api-key-saved" id="api-key-saved">Key saved</div>
      </div>
      <div class="gen-error" id="gen-error"></div>
      <div class="gen-actions">
        <button class="ctrl-btn secondary" onclick="closeGenerator()">Cancel</button>
        <button class="ctrl-btn primary" onclick="generateWorkout()">Generate</button>
      </div>
    </div>
    <div class="gen-loading" id="gen-loading">
      <div class="gen-spinner"></div>
      <p>Building your workout...</p>
    </div>
  </div>
</div>

<!-- Timer -->
<div id="timer-screen">
  <div class="round-lights" id="round-lights"></div>
  <div class="timer-center">
    <div class="phase-label" id="phase-label">ROUND 1</div>
    <div class="timer-display" id="timer-display">3:00</div>
    <div class="station-name" id="station-name"></div>
    <div class="station-desc" id="station-desc"></div>
    <div class="next-preview" id="next-preview"></div>
  </div>
  <div class="controls">
    <button class="ctrl-btn danger" onclick="quitWorkout()">Quit</button>
    <button class="ctrl-btn secondary" id="skip-btn" onclick="skipPhase()">Skip</button>
    <button class="ctrl-btn primary" id="pause-btn" onclick="togglePause()">Pause</button>
  </div>
</div>

<!-- Countdown Overlay -->
<div id="countdown-overlay">
  <div class="label">Get Ready</div>
  <div class="count" id="countdown-num">3</div>
</div>

<!-- Done Screen -->
<div id="done-screen">
  <h1>Done!</h1>
  <p>Total time</p>
  <div class="time" id="total-time">0:00</div>
  <button class="ctrl-btn primary" onclick="backToSelect()" style="margin-top:20px">Back to Workouts</button>
</div>

<div class="wake-lock" id="wake-lock-status"></div>

<script>
// ============================================================
// 8-WEEK RECOMP PROGRAM
// ============================================================
const RECOMP_START = new Date('2026-02-16T00:00:00');
const RECOMP_WEEKS = 8;

function getCurrentWeek() {
  const now = new Date();
  const diffMs = now - RECOMP_START;
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  const week = Math.floor(diffDays / 7) + 1;
  return Math.min(Math.max(week, 1), RECOMP_WEEKS);
}

function getWeekTargets(week) {
  const upperWeight = 45 + (week - 1) * 5;   // +5 lbs/week
  const lowerWeight = 45 + (week - 1) * 10;  // +10 lbs/week
  const sets = week <= 2 ? 3 : 4;
  const compoundReps = week <= 2 ? 10 : (week <= 6 ? 8 : 6);
  const pullupSets = week <= 2 ? 3 : 4;

  return {
    bench: upperWeight,
    ohp: upperWeight,
    rows: upperWeight,
    squat: lowerWeight,
    rdl: lowerWeight,
    sets,
    reps: compoundReps,
    pullupSets,
    volumeLabel: sets + ' x ' + compoundReps,
  };
}

// ============================================================
// DYNAMIC WORKOUT DATA
// ============================================================
function buildWorkouts(week) {
  const t = getWeekTargets(week);
  return [
    { // Push Day
      name: "Push Day 9 Rounds",
      rounds: [
        { station: "Warm-up", desc: "High knees 30s, shadow boxing 1 min, arm circles + bodyweight squats 30s, shadow box 1 min. Get loose, get warm." },
        { station: "Barbell Bench Press", desc: t.sets + "x" + t.reps + " @ " + t.bench + " lbs. Rest 60-90 sec between sets. Control the descent, explode up." },
        { station: "Bag - Jab/Cross", desc: "1-2 combos, move your feet. Shake out the bench pump. Stay light, find your rhythm." },
        { station: "Overhead Press", desc: t.sets + "x" + t.reps + " @ " + t.ohp + " lbs. Strict form, no leg drive. Brace your core." },
        { station: "Bag - Speed Round", desc: "Light, fast punches - high volume. 1-1-2, 1-2-3, 1-2-1-2. Don't load up, just stay busy. Circle the bag." },
        { station: "Ring Push-ups + Ring Dips", desc: "Ring push-ups 3x10, then ring dips 2x8. Superset - push-ups into dips, rest, repeat." },
        { station: "Bag - Power Round", desc: "Controlled hooks and uppercuts. 3-2-3, 5-6-5. Snap and retract at 70-80%. 10 sec burst, 5 sec reset." },
        { station: "Dumbbell Curls", desc: "3x12. Slow negatives. Squeeze at the top. Arms should be screaming." },
        { station: "Core Burnout", desc: "45s plank, 20 bicycle crunches, 15 leg raises, 10 V-ups. Rest 30 sec. Repeat x2." },
      ]
    },
    { // Pull Day
      name: "Pull Day 9 Rounds",
      rounds: [
        { station: "Warm-up", desc: "Shadow boxing 2 min (move your feet, throw light combos), high knees 30s, fast feet 30s." },
        { station: "Pull-ups", desc: t.pullupSets + "xAMRAP. Rest 90 sec between sets. Use a band if needed. Beat last week's reps." },
        { station: "Bag - 1-2-3 Combos", desc: "Jab-cross-hook. Focus on the hook rotation. Circle the bag between combos." },
        { station: "Barbell Rows", desc: t.sets + "x" + t.reps + " @ " + t.rows + " lbs. Squeeze your shoulder blades at the top. No body English." },
        { station: "Bag - Body Shots", desc: "Throw 1-2 up top, then dip and throw 2 body hooks. Practice level changes - head, body, head, body." },
        { station: "Ring Rows", desc: "3x10. Feet elevated if you can. Slow and controlled - 2 sec up, 2 sec down." },
        { station: "Bag - Full Combos", desc: "1-2-3-2, 1-2-5-2, 1-2-3-6-3-2. Let everything fly. Move your feet. Hands UP between combos." },
        { station: "DB Hammer Curls + Ring Hold", desc: "Hammer curls 3x12, then ring support hold 3x20 sec. Arms will be shaking." },
        { station: "Core Burnout", desc: "Hanging knee raises x15, plank 45s, Russian twists x20. Rest 30 sec. Repeat x2." },
      ]
    },
    { // Legs
      name: "Legs + Bag 9 Rounds",
      rounds: [
        { station: "Warm-up", desc: "High knees 30s, butt kicks 30s, lateral hops 30s, bodyweight squats 30s, shadow boxing 1 min." },
        { station: "Barbell Squats", desc: t.sets + "x" + t.reps + " @ " + t.squat + " lbs. Full depth. Control the descent. Drive through your heels." },
        { station: "Bag - Jab/Cross/Hook", desc: "1-2-3 combos. Legs are heavy from squats - plant your feet and rotate through the hips." },
        { station: "Romanian Deadlifts", desc: t.sets + "x" + t.reps + " @ " + t.rdl + " lbs. Slow negative, feel the hamstring stretch. Hinge at the hips." },
        { station: "Bag - Uppercuts + Body", desc: "5-6 uppercut combos with body hooks. Get low, bend knees, drive up through the legs." },
        { station: "Calf Raises + Squat Jumps", desc: "Calf raises 2x15, then squat jumps 2x10. Explosive on the jumps." },
        { station: "Bag - Power Round", desc: "Controlled hooks and uppercuts. 3-2-3, 5-6-5. Snap and retract at 70-80%. Stay composed." },
        { station: "BB Curls + Ring Dips", desc: "3x10 each. Curl, straight to dips, rest, repeat. Arm pump to finish." },
        { station: "Core Burnout", desc: "Barbell rollouts x10 (or ab wheel), side plank 30s/side, flutter kicks 30s. Rest 30 sec. Repeat x2." },
      ]
    },
    { // Freestyle
      name: "Full Body Brawler",
      rounds: [
        { station: "Warm-up", desc: "Shadow boxing 2 min (throw real combos, move around), high knees 30s, fast feet 30s." },
        { station: "Pick a Compound Lift", desc: "Bench (" + t.bench + " lbs), squats (" + t.squat + " lbs), rows (" + t.rows + " lbs), or OHP (" + t.ohp + " lbs). Do " + t.sets + "x" + t.reps + "." },
        { station: "Bag - Freestyle", desc: "Whatever you want. Combos, power shots, body work, movement. Just flow." },
        { station: "Pick a Ring Exercise", desc: "Push-ups, dips, rows, support holds - dealer's choice. 3 sets." },
        { station: "Bag - Speed Round", desc: "Light and fast. Nonstop volume punching. 1-2s, 1-1-2s. Don't stop. Cardio round." },
        { station: "Pick an Isolation Lift", desc: "Curls, hammer curls, calf raises, RDLs - whatever's lagging. 3x12." },
        { station: "Bag - War Round", desc: "3 min at 80%. Championship round. Best combos, best footwork, best form. Finish strong." },
        { station: "Pull-ups + Push-ups", desc: "Alternate: pull-up set, push-up set. 3 rounds. No rest between the two." },
        { station: "Core + Stretch", desc: "5 min core circuit (your choice), then 5 min stretching. Cool down. You earned it." },
      ]
    }
  ];
}

// ============================================================
// CONFIG
// ============================================================
const WORK_TIME = 180;   // 3 minutes
const REST_TIME = 90;    // 1.5 minutes
const WARN_TIME = 30;    // warning at 30 sec remaining
const TOTAL_ROUNDS = 9;

// ============================================================
// STATE
// ============================================================
let WORKOUTS = buildWorkouts(getCurrentWeek());
let currentWorkout = null;
let currentRound = 0;
let phase = 'work';
let timeLeft = 0;
let running = false;
let paused = false;
let interval = null;
let workoutStartTime = 0;
let wakeLock = null;

// ============================================================
// NAV TABS
// ============================================================
function switchTab(tab) {
  $('tab-workouts').classList.toggle('active', tab === 'workouts');
  $('tab-dashboard').classList.toggle('active', tab === 'dashboard');

  if (tab === 'workouts') {
    $('select-screen').style.display = 'flex';
    $('dashboard-screen').style.display = 'none';
  } else {
    $('select-screen').style.display = 'none';
    $('dashboard-screen').style.display = 'flex';
    updateDashboard();
  }
}

// ============================================================
// DASHBOARD
// ============================================================
function updateDashboard() {
  const week = getCurrentWeek();
  const t = getWeekTargets(week);
  const progress = Math.round((week / RECOMP_WEEKS) * 100);

  $('dash-week-num').textContent = week;
  $('dash-week-label').textContent = 'Week ' + week + ' of ' + RECOMP_WEEKS;
  $('progress-fill').style.width = progress + '%';

  // Lift targets
  $('t-bench').textContent = t.bench + ' lbs / ' + t.sets + 'x' + t.reps;
  $('t-ohp').textContent = t.ohp + ' lbs / ' + t.sets + 'x' + t.reps;
  $('t-pullups').textContent = t.pullupSets + ' x AMRAP';
  $('t-rows').textContent = t.rows + ' lbs / ' + t.sets + 'x' + t.reps;
  $('t-squat').textContent = t.squat + ' lbs / ' + t.sets + 'x' + t.reps;
  $('t-rdl').textContent = t.rdl + ' lbs / ' + t.sets + 'x' + t.reps;
  $('t-volume').textContent = t.volumeLabel;

  // Check-in week
  $('checkin-week-num').textContent = week;

  // Load existing check-in for this week
  const checkins = getCheckins();
  const existing = checkins['week' + week];
  if (existing) {
    $('checkin-weight').value = existing.weight || '';
    $('checkin-waist').value = existing.waist || '';
  } else {
    $('checkin-weight').value = '';
    $('checkin-waist').value = '';
  }

  // Render history
  renderHistory(checkins);
}

function getCheckins() {
  try {
    return JSON.parse(localStorage.getItem('recomp_checkins') || '{}');
  } catch { return {}; }
}

function saveCheckin() {
  const week = getCurrentWeek();
  const weight = $('checkin-weight').value.trim();
  const waist = $('checkin-waist').value.trim();

  if (!weight && !waist) return;

  const checkins = getCheckins();
  checkins['week' + week] = {
    weight: weight || null,
    waist: waist || null,
    date: new Date().toISOString().split('T')[0],
  };
  localStorage.setItem('recomp_checkins', JSON.stringify(checkins));

  $('checkin-saved-msg').style.display = 'block';
  setTimeout(() => { $('checkin-saved-msg').style.display = 'none'; }, 2000);

  renderHistory(checkins);
}

function renderHistory(checkins) {
  const container = $('history-rows');
  let html = '';
  let hasData = false;

  for (let w = 1; w <= RECOMP_WEEKS; w++) {
    const data = checkins['week' + w];
    if (data) {
      hasData = true;
      html += '<div class="history-row">' +
        '<span class="history-week">Week ' + w + '</span>' +
        '<span class="history-weight">' + (data.weight ? data.weight + ' lbs' : '-') + '</span>' +
        '<span class="history-waist">' + (data.waist ? data.waist + '"' : '-') + '</span>' +
        '</div>';
    }
  }

  if (!hasData) {
    html = '<div class="history-empty">No check-ins yet. Weigh in and measure your waist weekly.</div>';
  }

  container.innerHTML = html;
}

// ============================================================
// UPDATE SELECT SCREEN
// ============================================================
function updateSelectScreen() {
  const week = getCurrentWeek();
  const t = getWeekTargets(week);

  $('week-subtitle').textContent = 'Week ' + week + ' of 8 \u2014 Pick your workout';
  $('push-weight-hint').textContent = 'Bench ' + t.bench + ' lbs / OHP ' + t.ohp + ' lbs \u2014 ' + t.sets + 'x' + t.reps;
  $('pull-weight-hint').textContent = 'Rows ' + t.rows + ' lbs / Pull-ups ' + t.pullupSets + 'xAMRAP';
  $('leg-weight-hint').textContent = 'Squats ' + t.squat + ' lbs / RDL ' + t.rdl + ' lbs \u2014 ' + t.sets + 'x' + t.reps;
}

// ============================================================
// AUDIO (Web Audio API - zero dependencies)
// ============================================================
let audioCtx = null;

function getAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === 'suspended') audioCtx.resume();
  return audioCtx;
}

function playBeep(freq, duration, count, gap) {
  const ctx = getAudio();
  for (let i = 0; i < count; i++) {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.frequency.value = freq;
    osc.type = 'square';
    const start = ctx.currentTime + i * (duration + gap);
    gain.gain.setValueAtTime(0.3, start);
    gain.gain.exponentialRampToValueAtTime(0.001, start + duration);
    osc.start(start);
    osc.stop(start + duration);
  }
}

function playBell() {
  const ctx = getAudio();
  const freqs = [800, 1200, 1600, 2400];
  freqs.forEach((f, i) => {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.frequency.value = f;
    osc.type = 'sine';
    const vol = 0.15 / (i + 1);
    const t = ctx.currentTime;
    gain.gain.setValueAtTime(vol, t);
    gain.gain.exponentialRampToValueAtTime(0.001, t + 1.2);
    osc.start(t);
    osc.stop(t + 1.3);
  });
  const buf = ctx.createBuffer(1, ctx.sampleRate * 0.05, ctx.sampleRate);
  const data = buf.getChannelData(0);
  for (let i = 0; i < data.length; i++) data[i] = (Math.random() * 2 - 1) * (1 - i / data.length);
  const noise = ctx.createBufferSource();
  noise.buffer = buf;
  const ng = ctx.createGain();
  noise.connect(ng);
  ng.connect(ctx.destination);
  ng.gain.setValueAtTime(0.4, ctx.currentTime);
  ng.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
  noise.start(ctx.currentTime);
}

function playWarningBeeps() { playBeep(880, 0.15, 2, 0.12); }

function playTripleBell() {
  playBell();
  setTimeout(playBell, 500);
  setTimeout(playBell, 1000);
}

// ============================================================
// WAKE LOCK
// ============================================================
async function requestWakeLock() {
  try {
    if ('wakeLock' in navigator) {
      wakeLock = await navigator.wakeLock.request('screen');
      $('wake-lock-status').textContent = '';
    }
  } catch (e) { /* not critical */ }
}

function releaseWakeLock() {
  if (wakeLock) { wakeLock.release(); wakeLock = null; }
}

document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible' && running && !paused) requestWakeLock();
});

// ============================================================
// UI HELPERS
// ============================================================
function $(id) { return document.getElementById(id); }

function show(id) { $(id).style.display = 'flex'; }
function hide(id) { $(id).style.display = 'none'; }

function formatTime(secs) {
  const m = Math.floor(secs / 60);
  const s = secs % 60;
  return m + ':' + String(s).padStart(2, '0');
}

function buildRoundLights() {
  const container = $('round-lights');
  container.innerHTML = '';
  for (let i = 0; i < TOTAL_ROUNDS; i++) {
    const el = document.createElement('div');
    el.className = 'round-light';
    el.textContent = i + 1;
    el.id = 'light-' + i;
    container.appendChild(el);
  }
}

function updateRoundLights() {
  for (let i = 0; i < TOTAL_ROUNDS; i++) {
    const el = $('light-' + i);
    el.className = 'round-light';
    if (i < currentRound) {
      el.classList.add('done');
    } else if (i === currentRound) {
      el.classList.add('active');
      if (phase === 'rest') el.classList.add('rest');
      else if (timeLeft <= WARN_TIME && timeLeft > 0) el.classList.add('warning');
    }
  }
}

function updateTimerUI() {
  const display = $('timer-display');
  const label = $('phase-label');
  const sName = $('station-name');
  const sDesc = $('station-desc');
  const preview = $('next-preview');

  display.textContent = formatTime(timeLeft);
  display.className = 'timer-display';
  label.className = 'phase-label';

  if (phase === 'work') {
    const round = currentWorkout.rounds[currentRound];
    label.textContent = 'Round ' + (currentRound + 1);
    sName.textContent = round.station;
    sDesc.textContent = round.desc;

    if (timeLeft <= WARN_TIME && timeLeft > 0) {
      display.classList.add('warning');
      label.classList.add('warning');
    }

    if (currentRound < TOTAL_ROUNDS - 1) {
      preview.innerHTML = 'Next: <span>' + currentWorkout.rounds[currentRound + 1].station + '</span>';
    } else {
      preview.textContent = 'Final round!';
    }
  } else {
    label.textContent = 'REST';
    label.classList.add('rest');
    display.classList.add('rest');
    sName.textContent = '';
    sDesc.textContent = 'Shake it out. Grab water.';
    if (currentRound < TOTAL_ROUNDS) {
      preview.innerHTML = 'Up next: <span>Round ' + (currentRound + 1) + ' \u2014 ' + currentWorkout.rounds[currentRound].station + '</span>';
    }
  }

  updateRoundLights();
}

// ============================================================
// TIMER LOGIC
// ============================================================
function tick() {
  if (paused) return;
  timeLeft--;

  if (phase === 'work' && timeLeft === WARN_TIME) {
    playWarningBeeps();
  }

  if (timeLeft <= 0) {
    playBell();
    if (phase === 'work') {
      currentRound++;
      if (currentRound >= TOTAL_ROUNDS) {
        finishWorkout();
        return;
      }
      phase = 'rest';
      timeLeft = REST_TIME;
    } else {
      phase = 'work';
      timeLeft = WORK_TIME;
      playBell();
    }
  }

  updateTimerUI();
}

function startTimer() {
  if (interval) clearInterval(interval);
  interval = setInterval(tick, 1000);
  running = true;
}

function togglePause() {
  paused = !paused;
  $('pause-btn').textContent = paused ? 'Resume' : 'Pause';
}

function skipPhase() {
  if (phase === 'work') {
    currentRound++;
    if (currentRound >= TOTAL_ROUNDS) {
      finishWorkout();
      return;
    }
    phase = 'rest';
    timeLeft = REST_TIME;
  } else {
    phase = 'work';
    timeLeft = WORK_TIME;
  }
  playBell();
  updateTimerUI();
}

// ============================================================
// WORKOUT FLOW
// ============================================================
function startWorkout(idx) {
  getAudio();

  // Rebuild workouts with current week's weights
  WORKOUTS = buildWorkouts(getCurrentWeek());
  currentWorkout = WORKOUTS[idx];
  currentRound = 0;
  phase = 'work';
  timeLeft = WORK_TIME;
  paused = false;
  $('pause-btn').textContent = 'Pause';

  hide('select-screen');
  hide('done-screen');
  $('nav-tabs').classList.add('hidden');
  show('timer-screen');
  buildRoundLights();

  requestWakeLock();
  workoutStartTime = Date.now();

  // 3-2-1 countdown
  show('countdown-overlay');
  let count = 3;
  $('countdown-num').textContent = count;
  playBeep(600, 0.1, 1, 0);

  const cdInterval = setInterval(() => {
    count--;
    if (count > 0) {
      $('countdown-num').textContent = count;
      playBeep(600, 0.1, 1, 0);
    } else {
      clearInterval(cdInterval);
      hide('countdown-overlay');
      playBell();
      updateTimerUI();
      startTimer();
    }
  }, 1000);
}

function finishWorkout() {
  clearInterval(interval);
  interval = null;
  running = false;
  releaseWakeLock();

  const elapsed = Math.floor((Date.now() - workoutStartTime) / 1000);
  hide('timer-screen');
  show('done-screen');
  $('total-time').textContent = formatTime(elapsed);

  playTripleBell();
}

function quitWorkout() {
  clearInterval(interval);
  interval = null;
  running = false;
  paused = false;
  releaseWakeLock();
  hide('timer-screen');
  hide('countdown-overlay');
  $('nav-tabs').classList.remove('hidden');
  show('select-screen');
}

function backToSelect() {
  hide('done-screen');
  $('nav-tabs').classList.remove('hidden');
  show('select-screen');
}

// ============================================================
// WORKOUT GENERATOR (OpenRouter)
// ============================================================
const GEN_MODEL = 'google/gemini-2.0-flash-001';
let selectedFocus = 'surprise';

function openGenerator() {
  const saved = localStorage.getItem('openrouter_key');
  if (saved) {
    $('api-key-input').value = saved;
    $('api-key-saved').style.display = 'block';
  }
  $('gen-error').style.display = 'none';
  $('gen-form').classList.remove('hidden');
  $('gen-loading').classList.remove('active');
  show('generate-modal');
}

function closeGenerator() {
  hide('generate-modal');
}

function selectFocus(el) {
  document.querySelectorAll('#focus-chips .gen-chip').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedFocus = el.dataset.val;
}

function toggleEquip(el) {
  el.classList.toggle('on');
}

function getSelectedEquipment() {
  return Array.from(document.querySelectorAll('#equip-grid .equip-toggle.on'))
    .map(el => el.dataset.equip);
}

async function generateWorkout() {
  const apiKey = $('api-key-input').value.trim();
  if (!apiKey) {
    $('gen-error').textContent = 'Enter your OpenRouter API key';
    $('gen-error').style.display = 'block';
    return;
  }
  localStorage.setItem('openrouter_key', apiKey);
  $('api-key-saved').style.display = 'block';

  const equipment = getSelectedEquipment();
  if (equipment.length === 0) {
    $('gen-error').textContent = 'Select at least one piece of equipment';
    $('gen-error').style.display = 'block';
    return;
  }

  $('gen-error').style.display = 'none';
  $('gen-form').classList.add('hidden');
  $('gen-loading').classList.add('active');

  const week = getCurrentWeek();
  const t = getWeekTargets(week);

  const focusMap = {
    surprise: 'a random focus of your choice (push, pull, legs, full body, or something creative)',
    push: 'push muscles (chest, shoulders, triceps)',
    pull: 'pull muscles (back, biceps)',
    legs: 'legs and lower body',
    full: 'full body',
    cardio: 'cardio-heavy with minimal rest, high intensity',
  };

  const prompt = `You are a workout program designer for a home gym hybrid boxing + lifting program.

The user has this equipment: ${equipment.join(', ')}.
${equipment.includes('heavy bag') ? 'Heavy bag rounds should be mixed in between lifting rounds as active recovery/cardio.' : ''}

This is Week ${week} of an 8-week recomp program. Current weight targets:
- Upper body lifts (bench, OHP, rows): ${t.bench} lbs, ${t.sets}x${t.reps}
- Lower body lifts (squat, RDL): ${t.squat} lbs, ${t.sets}x${t.reps}
Include these specific weights and set/rep schemes in the workout descriptions.

Generate a 9-round workout focused on: ${focusMap[selectedFocus]}.

Rules:
- Exactly 9 rounds. Each round is 3 minutes of work followed by 90 sec rest.
- Round 1 is always a warm-up.
- Round 9 is always a core/cooldown finisher.
- ${equipment.includes('heavy bag') ? 'Alternate lifting rounds and bag rounds (rounds 2-8). Bag rounds should include specific boxing combos using numbers (1=jab, 2=cross, 3=lead hook, 4=rear hook, 5=lead uppercut, 6=rear uppercut).' : 'Fill all 9 rounds with exercises using the available equipment.'}
- Each round needs a short station name (2-5 words) and a detailed description with specific sets, reps, weights, and coaching cues.
- Be creative - don't repeat the same exercises every time. Mix it up.
- Write in a motivating, direct, no-BS coaching voice.

Respond with ONLY valid JSON, no markdown, no code fences. Use this exact format:
{
  "name": "Workout Name Here",
  "rounds": [
    {"station": "Station Name", "desc": "Detailed description with sets, reps, and cues."},
    ... (9 total)
  ]
}`;

  try {
    const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + apiKey,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: GEN_MODEL,
        messages: [{ role: 'user', content: prompt }],
        temperature: 1.0,
        max_tokens: 2000,
      }),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error?.message || 'API error ' + res.status);
    }

    const data = await res.json();
    const content = data.choices?.[0]?.message?.content;
    if (!content) throw new Error('Empty response from API');

    const cleaned = content.replace(/```json\s*/g, '').replace(/```\s*/g, '').trim();
    const workout = JSON.parse(cleaned);

    if (!workout.rounds || workout.rounds.length !== 9) {
      throw new Error('Invalid workout format (expected 9 rounds, got ' + (workout.rounds?.length || 0) + ')');
    }

    hide('generate-modal');
    currentWorkout = workout;
    currentRound = 0;
    phase = 'work';
    timeLeft = WORK_TIME;
    paused = false;
    $('pause-btn').textContent = 'Pause';

    hide('select-screen');
    hide('done-screen');
    $('nav-tabs').classList.add('hidden');
    show('timer-screen');
    buildRoundLights();
    requestWakeLock();
    workoutStartTime = Date.now();

    getAudio();

    show('countdown-overlay');
    let count = 3;
    $('countdown-num').textContent = count;
    playBeep(600, 0.1, 1, 0);
    const cdInterval = setInterval(() => {
      count--;
      if (count > 0) {
        $('countdown-num').textContent = count;
        playBeep(600, 0.1, 1, 0);
      } else {
        clearInterval(cdInterval);
        hide('countdown-overlay');
        playBell();
        updateTimerUI();
        startTimer();
      }
    }, 1000);

  } catch (e) {
    $('gen-loading').classList.remove('active');
    $('gen-form').classList.remove('hidden');
    $('gen-error').textContent = e.message || 'Something went wrong';
    $('gen-error').style.display = 'block';
  }
}

// ============================================================
// INIT
// ============================================================
updateSelectScreen();
</script>
</body>
</html>
