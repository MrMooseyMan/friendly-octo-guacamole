@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:wght@400;600&display=swap');

* { box-sizing: border-box; }

body {
    font-family: 'Inter', sans-serif;
    touch-action: none;
    background: linear-gradient(160deg, #0a1f0f 0%, #0f2e1a 40%, #0c2618 70%, #0a1a0f 100%);
    background-attachment: fixed;
    color: #e2e8f0;
    transition: background 1s ease;
}

.font-fantasy { font-family: 'Lora', serif; }

/* ── Game Board ── */
.game-board {
    display: grid;
    grid-template-columns: repeat(var(--grid-size, 6), 1fr);
    grid-template-rows: repeat(var(--grid-size, 6), 1fr);
    gap: 4px;
    user-select: none;
    touch-action: none;
}

/* ── Rune/Essence Tiles ── */
.rune {
    width: 100%;
    aspect-ratio: 1 / 1;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.12s ease;
    padding: 14%;
    position: relative;
    border: 1px solid rgba(255,255,255,0.06);
}

.rune:active { transform: scale(0.95); }

.rune.selected {
    transform: scale(1.1);
    z-index: 10;
    border-color: rgba(255,255,255,0.3);
}

.rune svg {
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
    pointer-events: none;
}

/* ── Essence Colors ── */
.rune-red {
    background: linear-gradient(145deg, #3b1525 0%, #2a0f1a 100%);
    box-shadow: inset 0 1px 0 rgba(244,63,94,0.15), 0 2px 4px rgba(0,0,0,0.3);
}
.rune-red svg { fill: #f43f5e; }
.rune-red.selected { box-shadow: 0 0 16px 6px rgba(244,63,94,0.5), inset 0 0 8px rgba(244,63,94,0.2); }

.rune-green {
    background: linear-gradient(145deg, #0f2e20 0%, #0a1f16 100%);
    box-shadow: inset 0 1px 0 rgba(16,185,129,0.15), 0 2px 4px rgba(0,0,0,0.3);
}
.rune-green svg { fill: #10b981; }
.rune-green.selected { box-shadow: 0 0 16px 6px rgba(16,185,129,0.5), inset 0 0 8px rgba(16,185,129,0.2); }

.rune-blue {
    background: linear-gradient(145deg, #0c2640 0%, #081a2e 100%);
    box-shadow: inset 0 1px 0 rgba(14,165,233,0.15), 0 2px 4px rgba(0,0,0,0.3);
}
.rune-blue svg { fill: #0ea5e9; }
.rune-blue.selected { box-shadow: 0 0 16px 6px rgba(14,165,233,0.5), inset 0 0 8px rgba(14,165,233,0.2); }

.rune-yellow {
    background: linear-gradient(145deg, #2e2008 0%, #201606 100%);
    box-shadow: inset 0 1px 0 rgba(245,158,11,0.15), 0 2px 4px rgba(0,0,0,0.3);
}
.rune-yellow svg { fill: #f59e0b; }
.rune-yellow.selected { box-shadow: 0 0 16px 6px rgba(245,158,11,0.5), inset 0 0 8px rgba(245,158,11,0.2); }

.rune-purple {
    background: linear-gradient(145deg, #251540 0%, #1a0e30 100%);
    box-shadow: inset 0 1px 0 rgba(167,139,250,0.15), 0 2px 4px rgba(0,0,0,0.3);
}
.rune-purple svg { fill: #a78bfa; }
.rune-purple.selected { box-shadow: 0 0 16px 6px rgba(167,139,250,0.5), inset 0 0 8px rgba(167,139,250,0.2); }

.rune-white {
    background: linear-gradient(145deg, #2a2a32 0%, #1e1e26 100%);
    box-shadow: inset 0 1px 0 rgba(241,245,249,0.15), 0 2px 4px rgba(0,0,0,0.3);
}
.rune-white svg { fill: #f1f5f9; }
.rune-white.selected { box-shadow: 0 0 16px 6px rgba(254,243,199,0.5), inset 0 0 8px rgba(254,243,199,0.2); }

/* ── Frozen ── */
.rune.frozen {
    pointer-events: none;
    filter: brightness(0.6) saturate(0.4);
    border-color: rgba(56,189,248,0.4);
}
.rune.frozen::after {
    content: attr(data-frozen-turns);
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: 900;
    color: #7dd3fc;
    text-shadow: 0 0 8px #0ea5e9, 0 0 16px #0284c7;
    background: rgba(14,165,233,0.12);
    border-radius: 10px;
    z-index: 5;
}

/* ── Cascade ── */
.rune.cascade-glow {
    animation: cascade-pulse 0.25s ease-in-out;
    box-shadow: 0 0 18px 8px rgba(251,191,36,0.5) !important;
    border-color: rgba(251,191,36,0.6);
}

/* ── Loop Target ── */
.rune.loop-target {
    animation: loop-target-glow 0.4s ease-in-out infinite alternate;
}
@keyframes loop-target-glow {
    0% { box-shadow: 0 0 8px 3px rgba(251,191,36,0.3); }
    100% { box-shadow: 0 0 18px 8px rgba(251,191,36,0.6); border-color: rgba(251,191,36,0.5); }
}

/* ── Loop Indicator ── */
.loop-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.4rem;
    font-weight: 900;
    color: #fbbf24;
    text-shadow: 0 0 20px rgba(251,191,36,0.8), 0 2px 4px rgba(0,0,0,0.8);
    z-index: 25;
    animation: loop-pulse 0.5s ease-in-out infinite;
    pointer-events: none;
}
@keyframes loop-pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.15); }
}

/* ── Animations ── */
@keyframes fall {
    from { transform: translateY(-60px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-5px); }
    40%, 80% { transform: translateX(5px); }
}
@keyframes shake-big {
    0%, 100% { transform: translate(0); }
    10%, 50%, 90% { transform: translate(-7px, -2px); }
    30%, 70% { transform: translate(7px, 2px); }
}
@keyframes shake-small {
    0%, 100% { transform: translateX(0); }
    25%, 75% { transform: translateX(-3px); }
    50% { transform: translateX(3px); }
}
@keyframes pulse-bright {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(1.4); }
}
@keyframes boss-glow {
    0%, 100% { box-shadow: 0 0 8px 3px rgba(245,158,11,0.4), inset 0 0 4px rgba(245,158,11,0.2); }
    50% { box-shadow: 0 0 16px 6px rgba(245,158,11,0.6), inset 0 0 8px rgba(245,158,11,0.3); }
}
@keyframes float-up-big {
    0% { transform: translateY(0) scale(1.2); opacity: 1; }
    100% { transform: translateY(-50px) scale(1.4); opacity: 0; }
}
@keyframes cascade-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); }
    100% { transform: scale(1); }
}
@keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-45px) scale(1.1); opacity: 0; }
}
@keyframes perk-slide-in {
    from { transform: translateY(-8px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
@keyframes achievement-pop {
    0% { transform: translateY(16px) scale(0.9); opacity: 0; }
    60% { transform: translateY(-3px) scale(1.02); opacity: 1; }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}
@keyframes guardian-ready-pulse {
    0%, 100% { box-shadow: 0 0 4px var(--guardian-color, #10b981); }
    50% { box-shadow: 0 0 14px var(--guardian-color, #10b981); }
}

.animate-fall { animation: fall 0.2s ease-out; }
.animate-shake { animation: shake 0.35s ease-in-out; }
.shake-big { animation: shake-big 0.3s ease-in-out; }
.shake-small { animation: shake-small 0.2s ease-in-out; }
.animate-pulse-bright { animation: pulse-bright 0.5s ease-in-out 2; }

/* ── UI Elements ── */
.hp-bar-bg {
    background: rgba(15,23,42,0.8);
    border-radius: 9999px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
}
.hp-bar {
    height: 100%;
    transition: width 0.35s ease-in-out;
    border-radius: 9999px;
    position: relative;
}
.hp-bar-player { background: linear-gradient(90deg, #059669, #34d399); }
.hp-bar-enemy { background: linear-gradient(90deg, #dc2626, #fb7185); }

/* ── Guardian Bar ── */
.guardian-bar-container {
    background: rgba(15,23,42,0.7);
    border: 1px solid rgba(51,65,85,0.4);
    border-radius: 12px;
    padding: 6px 10px;
    backdrop-filter: blur(4px);
    transition: border-color 0.3s, box-shadow 0.3s;
}
.guardian-bar-container.charged {
    border-color: var(--guardian-color, rgba(16,185,129,0.6));
    animation: guardian-ready-pulse 1.5s ease-in-out infinite;
}
.guardian-bar-fill {
    background: linear-gradient(90deg, #059669, #10b981);
    transition: width 0.3s ease;
}
.guardian-bar-fill.storm { background: linear-gradient(90deg, #0284c7, #38bdf8); }
.guardian-bar-fill.ember { background: linear-gradient(90deg, #be123c, #f43f5e); }
.guardian-bar-fill.stone { background: linear-gradient(90deg, #b45309, #f59e0b); }
.guardian-bar-fill.shadow { background: linear-gradient(90deg, #6d28d9, #a78bfa); }
.guardian-bar-fill.verdant { background: linear-gradient(90deg, #059669, #10b981); }

.guardian-activate-btn {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 6px;
    border: none;
    animation: pulse-bright 1.5s ease-in-out infinite;
    box-shadow: 0 0 8px rgba(99,102,241,0.4);
}
.guardian-activate-btn:hover {
    background: linear-gradient(135deg, #818cf8, #a78bfa);
}

/* ── Portrait ── */
.portrait-container {
    width: 64px;
    height: 64px;
    background: linear-gradient(145deg, #1e293b, #0f172a);
    border: 2px solid rgba(51,65,85,0.6);
    border-radius: 12px;
    padding: 5px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
    flex-shrink: 0;
    transition: all 0.3s ease;
}
.portrait-container svg { width: 100%; height: 100%; }
.player-portrait { border-color: rgba(16,185,129,0.5); }
.boss-portrait { border-color: rgba(245,158,11,0.6); animation: boss-glow 2s ease-in-out infinite; }

/* ── Board Container ── */
#game-board-container {
    background: linear-gradient(180deg, rgba(15,23,42,0.85), rgba(10,15,30,0.9));
    border-color: rgba(51,65,85,0.4) !important;
    backdrop-filter: blur(8px);
}

/* ── Modal ── */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(12px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    padding: 1rem;
}
.modal-backdrop.visible { opacity: 1; pointer-events: auto; }
.modal-content {
    transform: scale(0.92) translateY(16px);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.modal-backdrop.visible .modal-content { transform: scale(1) translateY(0); }

/* ── Connector ── */
#connector-svg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 20;
}
.connector-line {
    fill: none;
    stroke: rgba(255,255,255,0.6);
    stroke-width: 4;
    stroke-linecap: round;
    stroke-linejoin: round;
    filter: drop-shadow(0 0 5px rgba(255,255,255,0.4));
}
.connector-line.loop {
    stroke: rgba(251,191,36,0.8);
    stroke-width: 5;
    filter: drop-shadow(0 0 8px rgba(251,191,36,0.6));
}

/* ── Floating Text ── */
.floating-text {
    position: absolute;
    font-weight: 700;
    font-size: 1rem;
    pointer-events: none;
    animation: floatUp 0.9s forwards;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    z-index: 30;
    white-space: nowrap;
}
.floating-text.big-crit {
    font-size: 1.4rem;
    animation: float-up-big 1s forwards;
    text-shadow: 0 0 8px currentColor, 0 2px 6px rgba(0,0,0,0.9);
}

/* ── Loot ── */
.loot-display {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    background: rgba(0,0,0,0.3);
    padding: 0.75rem;
    border-radius: 0.5rem;
}
.gold-reward { color: #fbbf24; font-weight: bold; font-size: 1.05rem; }
.xp-reward { color: #a78bfa; font-weight: bold; }
.potion-reward { color: #10b981; font-weight: bold; }

/* ── Stats ── */
.stats-grid { display: grid; gap: 0.4rem; }
.stats-grid > div { display: flex; justify-content: space-between; padding: 0.2rem 0; border-bottom: 1px solid rgba(255,255,255,0.07); }
.stats-grid > div:last-child { border-bottom: none; }
.stats-grid strong { color: #fbbf24; }

/* ── Meta / Achievements ── */
.legacy-section { border-top: 1px solid rgba(255,255,255,0.08); padding-top: 0.5rem; }
.achievement-section { border-top: 1px solid rgba(16,185,129,0.25); padding-top: 0.5rem; }
.achievement-item {
    background: rgba(16,185,129,0.08);
    border: 1px solid rgba(16,185,129,0.15);
    border-radius: 0.5rem;
    padding: 0.4rem 0.5rem;
    margin-bottom: 0.3rem;
    animation: achievement-pop 0.4s ease-out;
}

/* ── Perk Tags ── */
.perk-tag {
    display: inline-block;
    background: rgba(16,185,129,0.1);
    border: 1px solid rgba(16,185,129,0.25);
    color: #6ee7b7;
    font-size: 0.6rem;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: 9999px;
    animation: perk-slide-in 0.3s ease-out;
}

/* ── Buttons ── */
button { cursor: pointer; transition: all 0.15s ease; }
button:active { transform: scale(0.95); }
.upgrade-choice:hover { transform: translateY(-2px); }
.upgrade-choice:active { transform: translateY(0); }
#floor-display { text-shadow: 0 1px 3px rgba(0,0,0,0.5); }

/* ── Path Cards ── */
.path-card {
    background: rgba(15,23,42,0.8);
    border: 1px solid rgba(51,65,85,0.5);
    border-radius: 12px;
    padding: 12px 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    text-align: left;
}
.path-card:hover {
    background: rgba(30,41,59,0.9);
    border-color: rgba(100,116,139,0.6);
    transform: translateX(4px);
}
.path-card:active { transform: translateX(2px) scale(0.98); }
.path-card-icon { font-size: 1.5rem; width: 36px; text-align: center; flex-shrink: 0; }

/* ── Guardian Cards ── */
.guardian-card {
    background: rgba(15,23,42,0.8);
    border: 1px solid rgba(51,65,85,0.5);
    border-radius: 12px;
    padding: 10px 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    text-align: left;
}
.guardian-card:hover {
    border-color: rgba(139,92,246,0.5);
    transform: translateY(-2px);
    background: rgba(30,25,60,0.6);
}
.guardian-card.equipped {
    border-color: rgba(16,185,129,0.5);
    background: rgba(16,185,129,0.08);
}

/* ── Responsive ── */
@media (max-height: 700px) {
    .portrait-container { width: 56px; height: 56px; }
    .rune { padding: 11%; }
}
@media (max-height: 600px) {
    .portrait-container { width: 48px; height: 48px; }
    #game-container { padding: 0.25rem; }
}
